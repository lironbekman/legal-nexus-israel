# מערכת ניהול משתמשים והרשאות - Legal Nexus Israel

## סקירה כללית

מערכת ניהול המשתמשים החדשה מאפשרת ניהול מתקדם של משתמשים, הרשאות ותפריטים במערכת Legal Nexus Israel. המערכת משלבת את Supabase לניהול מסד נתונים מאובטח ומערכת הרשאות גמישה.

## תכונות עיקריות

### 👥 ניהול משתמשים
- **הוספת משתמשים חדשים** עם פרטים מלאים
- **עריכת פרטי משתמש** כולל מידע אישי, כתובת ופרטי חירום
- **ניהול תפקידים** (מנהל, עורך דין, עוזר, לקוח)
- **הפעלה/השבתה** של משתמשים
- **מחיקת משתמשים** עם אישור

### 🔐 מערכת הרשאות מתקדמת
- **הרשאות מותאמות אישית** לכל משתמש
- **קבוצות הרשאות** לשימוש חוזר
- **ניהול תפריטים דינמי** לפי הרשאות
- **הרשאות גרגוליות** לכל פונקציה במערכת

### 📊 סטטיסטיקות וניטור
- **ספירת משתמשים** לפי סטטוס ותפקיד
- **מעקב הרשאות** וזיהוי בעיות
- **דוחות שימוש** במערכת

## שדות משתמש זמינים

### מידע בסיסי
- שם מלא
- אימייל
- תפקיד
- טלפון
- מחלקה

### כתובת מגורים
- כתובת מלאה
- עיר
- מיקוד

### פרטים אישיים
- תאריך לידה
- תעודת זהות
- הערות נוספות

### איש קשר לחירום
- שם איש קשר
- טלפון חירום

## הרשאות זמינות

### דשבורד ותיקים
- `can_view_dashboard` - צפייה בדשבורד
- `can_view_cases` - צפייה בתיקים
- `can_edit_cases` - עריכת תיקים
- `can_delete_cases` - מחיקת תיקים

### לקוחות ומסמכים
- `can_view_clients` - צפייה בלקוחות
- `can_edit_clients` - עריכת לקוחות
- `can_view_documents` - צפייה במסמכים
- `can_edit_documents` - עריכת מסמכים

### יומן וחיוב
- `can_view_calendar` - צפייה ביומן
- `can_edit_calendar` - עריכת יומן
- `can_view_billing` - צפייה בחיוב
- `can_edit_billing` - עריכת חיוב

### דוחות וכלים
- `can_view_reports` - צפייה בדוחות
- `can_edit_reports` - עריכת דוחות
- `can_view_legal_library` - ספריה משפטית
- `can_view_disability_calculator` - מחשבון נכות

### הרשאות מערכת
- `can_manage_users` - ניהול משתמשים
- `can_manage_permission_groups` - ניהול קבוצות הרשאות
- `can_manage_system_settings` - ניהול הגדרות מערכת
- `can_view_audit_logs` - צפייה ביומני מערכת

## קבוצות הרשאות מוכנות

### 🎯 מנהל מערכת
- הרשאות מלאות לכל הפונקציות
- גישה לניהול מערכת
- הרשאות ניהול משתמשים

### ⚖️ עורך דין בכיר
- עריכת תיקים ולקוחות
- צפייה בדוחות
- ניהול מסמכים
- ללא הרשאות מחיקה

### 👨‍💼 עורך דין
- עריכת תיקים ולקוחות
- צפייה בדוחות
- הרשאות בסיסיות

### 🆘 עוזר משפטי
- צפייה בתיקים ולקוחות
- הרשאות עריכה מוגבלות
- גישה לכלים בסיסיים

### 👤 לקוח
- הרשאות צפייה מוגבלות
- גישה למידע אישי בלבד

## הוראות שימוש

### 1. הוספת משתמש חדש
1. לך לטאב "ניהול משתמשים"
2. לחץ על "הוסף משתמש חדש"
3. מלא את הפרטים הנדרשים
4. בחר תפקיד (הרשאות יוקצו אוטומטית)
5. בחר קבוצת הרשאות (אופציונלי)
6. לחץ על "צור משתמש"

### 2. עריכת משתמש קיים
1. בטבלת המשתמשים, לחץ על כפתור העריכה (עיפרון)
2. ערוך את הפרטים הרצויים
3. לחץ על "שמור שינויים"

### 3. ניהול הרשאות
1. בטבלת המשתמשים, לחץ על כפתור ההרשאות (מגן)
2. בחר קבוצת הרשאות או הגדר הרשאות מותאמות אישית
3. לחץ על "שמור הרשאות"

### 4. שינוי סטטוס משתמש
1. בטבלת המשתמשים, השתמש במתג הסטטוס
2. המשתמש יופעל או יושבת מיד

## הגדרת Supabase

### שלב 1: יצירת פרויקט
1. היכנס ל-[supabase.com](https://supabase.com)
2. צור פרויקט חדש
3. העתק את מפתחות ה-API

### שלב 2: הגדרת משתני סביבה
צור קובץ `.env.local`:
```env
VITE_SUPABASE_URL=https://your-project-id.supabase.co
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
```

### שלב 3: הרצת SQL Setup
הרץ את הפקודות SQL מקובץ `SUPABASE_SETUP.md`

## אבטחה

### Row Level Security (RLS)
- כל הטבלאות מוגנות ב-RLS
- משתמשים יכולים לראות רק את המידע שלהם
- מנהלים יכולים לראות ולערוך הכל

### הרשאות מבוססות תפקיד
- הרשאות מוקצות אוטומטית לפי תפקיד
- אפשרות להתאמה אישית של הרשאות
- תמיכה בקבוצות הרשאות לשימוש חוזר

### אימות משתמשים
- מערכת התחברות מאובטחת
- סיסמאות מוצפנות
- אימות אימייל

## פתרון בעיות

### שגיאות נפוצות
1. **"Missing Supabase environment variables"**
   - בדוק שקובץ `.env.local` קיים
   - בדוק שהמפתחות נכונים

2. **"Permission denied"**
   - בדוק שהמשתמש מחובר
   - בדוק שיש הרשאות מתאימות

3. **"Table doesn't exist"**
   - הרץ את פקודות ה-SQL Setup
   - בדוק שמות הטבלאות

### לוגים וניטור
- בדוק את Console של הדפדפן
- השתמש בכלי הניטור של Supabase
- בדוק את יומני המערכת

## תמיכה ופיתוח

### תכונות עתידיות
- [ ] ניהול קבוצות הרשאות מתקדם
- [ ] תבניות הרשאות מותאמות
- [ ] יומני פעילות מפורטים
- [ ] הרשאות מבוססות זמן
- [ ] אינטגרציה עם מערכות חיצוניות

### דיווח באגים
- השתמש ב-Issues של הפרויקט
- תאר את הבעיה בפירוט
- צרף לוגים וסקרינשוטים

## רישיון

המערכת פותחה עבור Legal Nexus Israel ומוגנת בזכויות יוצרים.

---

**הערה**: מערכת זו דורשת חיבור ל-Supabase כדי לעבוד. עקוב אחר הוראות ההגדרה בקובץ `SUPABASE_SETUP.md`.


